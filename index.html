<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Peta Sebaran SPKLU Kalimantan Barat</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; }
#map { height:100vh; }
.panel {
  position:absolute;
  top:10px;
  left:10px;
  z-index:1000;
  background:white;
  padding:10px;
  border-radius:6px;
}
</style>
</head>

<body>

<div class="panel">
<b>Peta SPKLU Kalimantan Barat</b><br><br>
<select id="filterKota">
  <option value="all">Semua Kota</option>
</select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([0.1, 109.5], 7);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

// ICON
const icons = {
  "FAST CHARGING": L.icon({ iconUrl:'icons/fast.png', iconSize:[30,30] }),
  "MEDIUM CHARGING": L.icon({ iconUrl:'icons/medium.png', iconSize:[30,30] }),
  "ULTRA FAST CHARGING": L.icon({ iconUrl:'icons/ultra.png', iconSize:[30,30] })
};

let markers = [];
let allData = [];

// LOAD CSV
fetch('spklu_kalbar.csv')
.then(res => res.text())
.then(text => {
  const rows = text.split('\n').slice(1);

  rows.forEach(row => {
    if(!row) return;
    const col = row.split(',');

    const data = {
      nama: col[0],
      alamat: col[1],
      lat: parseFloat(col[2]),
      lon: parseFloat(col[3]),
      kota: col[4],
      type: col[5],
      kw: col[6]
    };

    if(isNaN(data.lat) || isNaN(data.lon)) return;

    allData.push(data);
    addMarker(data);
    addFilterOption(data.kota);
  });
});

// MARKER
function addMarker(d){
  const marker = L.marker([d.lat, d.lon], {
    icon: icons[d.type] || icons["FAST CHARGING"]
  })
  .bindPopup(`
    <b>${d.nama}</b><br>
    ${d.alamat}<br>
    ${d.type} (${d.kw} kW)
  `)
  .addTo(map);

  marker.kota = d.kota;
  markers.push(marker);
}

// FILTER
function addFilterOption(kota){
  const select = document.getElementById('filterKota');
  if (![...select.options].some(o => o.value === kota)) {
    const opt = document.createElement('option');
    opt.value = kota;
    opt.textContent = kota;
    select.appendChild(opt);
  }
}

document.getElementById('filterKota').addEventListener('change', e=>{
  markers.forEach(m=>{
    if(e.target.value === 'all' || m.kota === e.target.value){
      map.addLayer(m);
    } else {
      map.removeLayer(m);
    }
  });
});
</script>

</body>
</html>
