<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Peta Sebaran SPKLU Kalimantan Barat</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; }
#map { height:100vh; }
.panel {
  position:absolute;
  top:10px;
  left:10px;
  z-index:1000;
  background:white;
  padding:10px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
}
</style>
</head>

<body>

<div class="panel">
<b>Peta SPKLU Kalimantan Barat</b><br><br>
<select id="filterKota">
  <option value="all">Semua Kota / Kabupaten</option>
</select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([0.1, 109.5], 7);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

// ICON
const icons = {
  "FAST CHARGING": L.icon({ iconUrl:'icon/fast.png', iconSize:[30,30] }),
  "MEDIUM CHARGING": L.icon({ iconUrl:'icon/mediumfast.png', iconSize:[30,30] }),
  "ULTRA FAST CHARGING": L.icon({ iconUrl:'icon/ultrafast.png', iconSize:[30,30] })
};

let markers = [];
let kotaSet = new Set();

// LOAD CSV (delimiter ;)
fetch('spklu_kalbar.csv')
.then(res => res.text())
.then(text => {

  const rows = text.trim().split('\n').slice(1);

  rows.forEach(row => {
    if(!row) return;

    const col = row.split(';');

    const data = {
      nama   : col[0],
      alamat : col[1],
      lat    : parseFloat(col[2]),
      lon    : parseFloat(col[3]),
      kota   : col[5],
      type   : col[6],
      kw     : col[7]
    };

    if (isNaN(data.lat) || isNaN(data.lon)) return;

    addMarker(data);
    kotaSet.add(data.kota);
  });

  // isi dropdown filter
  const select = document.getElementById('filterKota');
  [...kotaSet].sort().forEach(kota=>{
    const opt = document.createElement('option');
    opt.value = kota;
    opt.textContent = kota;
    select.appendChild(opt);
  });
});

// MARKER
function addMarker(d){
  const marker = L.marker([d.lat, d.lon], {
    icon: icons[d.type] || icons["FAST CHARGING"]
  })
  .bindPopup(`
    <b>${d.nama}</b><br>
    ${d.alamat}<br>
    ${d.kota}<br>
    <b>${d.type}</b><br>
    Daya: ${d.kw} kW
  `)
  .addTo(map);

  marker.kota = d.kota;
  markers.push(marker);
}

// FILTER
document.getElementById('filterKota').addEventListener('change', e=>{
  markers.forEach(m=>{
    if(e.target.value === 'all' || m.kota === e.target.value){
      map.addLayer(m);
    } else {
      map.removeLayer(m);
    }
  });
});
</script>

</body>
</html>
